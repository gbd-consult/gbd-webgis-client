/// map loader

import ol from 'ol-all';

import wms from './wms';
import config from '../app/config';


let loaders = {

    async osm(opts) {
        opts.source = new ol.source.OSM();
        return new ol.layer.Tile(opts);
    },

    async stamen(opts) {
        opts.source = new ol.source.Stamen({
            layer: opts.layer
        });
        return new ol.layer.Tile(opts);
    },


    async wmsTile(opts) {
        opts.source = new ol.source.TileWMS(opts);
        return new ol.layer.Tile(opts);
    },

    async wmsGroup(opts) {
        let root = await wms.getLayers(opts.url);
        root.set('name', opts.name);
        return root;
    }
};


async function load(map) {
    let ls = [...config.object('map.layers')].reverse();
    for (let opts of ls) {
        if (!loaders[opts.type])
            continue;
        let la = await loaders[opts.type](opts);
        if (la)
            map.attachLayer('project', la);

    }
    return map;
}

export default {load};