/// map loader

import ol from 'ol-all';

import config from '../app/config';


function layerOptions(bg) {

    if (bg.type === 'osm') {
        return {
            source: new ol.source.OSM(),
            name: 'OSM',
        };
    }

    if (bg.type === 'wms') {
        return {
            source: new ol.source.TileWMS(bg),
            name: bg.name
        }
    }
}

function loadBackgrounds(map, backgrounds) {
    let cnt = 0;

    (backgrounds || []).forEach(bg => {
        let opts = layerOptions(bg);
        if (opts) {
            opts.visible = cnt === 0;
            opts.opacity = bg.opacity || 1;
            opts.kind = 'backgroundLayer';
            map.attachLayer('background', new ol.layer.Tile(opts));
            cnt++;
        }
    });


}

async function load(map) {
    loadBackgrounds(map, config.object('map.backgrounds'));
    return map;

}

export default {load};